import os, sys, asyncio
from re_gpt import AsyncChatGPT
from dotenv import load_dotenv

load_dotenv()

session_token = os.getenv("SESSION_TOKEN", "eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..YHr7sc42D6j4FA5q.xcRTT43IPfYjoQRrszU24V4fkOjtb6KE1Vrm8Th5xUmrUDLpBz7BOy3vOW1cqAPjmS9_DZkymPuVO702y1a6F6RSQMEezgWjo793J9kYfwaM5VVqR_rsenIWWes_7fW033JULMstt6L4cHHsDtjkTYTstBtD5RQjVnWYlZz3Msyk7jn9WYujwy41HPlWHCwFuE-aQT6fa28MvtJzrFobjMRwlWvbcJYjghRk5LmN3I11PGQELNPm9d25D1lczvZ4cbUouzQyUG37SGe4BMNqsqWCk0TG1p06XaYf16S9x2g5ZkqOEhmzbFqJ-G17W4xIfdLLsEy00Z4O1T1r11ZgScjSkotDFExYkjO3U6BdQQ1zDB0WMRPiXczogP2Dt09SgcC0t1rsxV6Ok-yTMk6-vJxjkAthzgOTyiEkkGpa2-vTldiQGZMYugZAUoKY92W2NUufwumBkuLN0G3E0SPwk9S0NjS1sriw_OIBENUOBm0DFoPKocS72kludtm6MGshh3qGXhs6psx2FXAtTiyMMj5v-sTpbIia1F512mhjkEV6kQvfJNh2U9CQNBc3VMO4lqByfjfdDB30JaHfplgIClm-7djRnT7ZOpxNm8hBXYB9pSsfJvGvsQJ4JABmyiLr1_BkHS2S4zapBKjY9itn84_PrRUiFJP3r27pO64Wk54eMsbWX5dK6o79CrIHyDV-e3CtCMFJHgfEk9zLSYAGkuGGNNqbv9YDH0-aRVSfZN3EqGQoOqLehjSDj1jnNEYIfksrbGwLj9odHWg2RrJ091zQxEAv04Q8BxuRLxPyX5a5U7H_jVhsfuWNZXz6CS1Y9SSE2Lwz8gqR_lD6ql6Ba-Uua-Zo4cml_07ODWuLg0yDLrTGESboB9Fh0rbwuBw_24_U8W05uWfckZzstPZVRF3HUAA2i_JlapbCgX6wSd2yy6yK94CDzBMiWJf5msZSnZG0Swm5w5cWy5XnY6uU2G7i4layT7xYlvnI2r5TBA30luD_EGpXuu9szpLhotZBxHGNwDEKqMnowu7i_EC3m3eAicjh_CTuW6bo-mIWeGQfajJgx9LHji7UX3j8b2aHqsMskJDY3cTyjrN9SnvQgtIoBrEeD7JiWM42HzdPxxddO3T05JHGnCuhFUfqTV7vZwpawP7Ozb5XSBp8ipvZKF8ps10oT-Y3q4jfmgeluyxi9Grq7xbI7mqe-LqfS5pe7qWrQGU5Qslavw4t_B_phAbh30npvkv5Uux3jDaoybBJOy3Ub37K8EZeiqCxBFlsiBhVIO-18td5y_sdKrqgYw-w4OpDOUViW4mZ7p3dxC9Zk3W5_gcmLy-WI2kN1sATOwo5I1hvTTyTuQY6DXq0yiHA4zweeaVAiS5AGFGo1YoDFSL4UqvVEZlcqAnmqvjU2ZB5nQMAk93PdFeqAYC2XcxEz_DkL1Kytyxm6p60f3iWPz6ZigsVgTSFuBUpsaP6oHjUg1ZD-JEh0nBT0nCRdJGYxdSv1dncCk6uuQxLsKhkvW-8GnZ-da9FcqYJCeyScn-kOHngU966z1UYG9SXZODeFbLn3q9AOGXp6U9QcI_8Buulmgu4aM-FL_Uxw288kvxZku5IRKOozBGLtu8JW4WirqepQtDPBOVtqNE8O8tRfDLZubP_g5q-gK3bRZFjgmv5ElqW-f-3zdRueFV0rbjdOhtMqBkRFNvOBAAaYS_BwniA7YmHJJm1rSUN3ZdZl_gSgVU5nERBuCiYu_iE1TurJ4vqR5zkEJK4WgLfIwK2-CygY43AtywNQKaJp8Bq1wtYxNKmwPgYuclFTjv50xutJc__Wrxw-t9FypnS9KgUJnRgARJyM5pJIAZsmo9AYvWr3Q_X3JdOZiBL4_tv0UDVByx-b6oj6sK1B1gFExl43sI4fAUd-wyKEhzkmnxLMqojcbGiwEzin6RL9w05ZCOmEDDHDifYHB6GmNYqC8S6EGXPoB8dcifrHR5TpOGsMisA7G_nI5f37UgZ0E7CmTzYSxjPg2usGAJZJ4jvrW4cJgyVXAb5mKMofp8xLa9rFh4cneL3-E4IZ9xKhMxA_AyI2CxC622LHoMZLF2WbE9Xfoatulu7FiFvQX2gjbhlGAl40rywszaGxfIFgeYXFWt1ZRaaBy4iUrdbHaFRFsk6nZV27E2ubJbtS9p-lEShexGPwLpX5ztZxlhRAzyEyRaB5AVGsAh3oTDnk8rqfNsjRnI8iqgmG2DoZSbTQePEIidIsCyE3jF9pLvoTB54RwGxPY36y7Z1_CAegLQIWVROYNz-YcyqllLke-WuyQrkchHEzV4CDdTMulrTWb1QCA5Zg8AqrUWhK096577a3GxAHMz-zJeraVkP9V6A6MC7htnv2zRkXj2ohrVgb3Wxs4zZalVRGWsPIEwjzoKf3h1vuzMMe8AnT4VAkYVdtBkzGNm0En50CBn0HZSUHh0MLNQvoIp5K9WRBGcGPm5x-cNaeH29oJC8WpAiiK-LmEzekWaP-rq9P2kXDgitrSgU-ceN4d-h9xyBsBv9RDPncvsqf3OqAIteXbORO_6wri9Evr8Y_Pz3SKyfQGXJRz9QtMD5Zbbd0r9rr90EEYhniJ6Z_XgYqjJScfOwlhJ9vqxB8T_bnHpfa54-u5l86_1rbbV_YGNYl17EsIu2LvJXFGRWixgVgi2cq_AT2gFJHs-He6hnF3JF7P4e2A8rJCyef2EUyo0ckfp4w10_p6l2Ip1C6P9XOozZ3ClR7q4LZkiGYFmrGez71peZm-i5sbjz2mb2UdREHcTjegv1W-9GlyS3IRMXkPxkT2Rugl1bxBNApc9AHPTK9krIleIEeaNoHYsZTrjNbfn7Sw06YeggR2Sk_dNuU1c4FtPepuHH_zU7c8i8-oAJyWg9.2B5Cv5cvFcsj9ZkpeTkhBQ")

if sys.version_info >= (3, 8) and sys.platform.lower().startswith("win"):
    asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
    

async def chatgpt() -> AsyncChatGPT:
    return await AsyncChatGPT(session_token=session_token).__aenter__()


async def generate_response(conversation, prompt: str):
    pending_response = ""
    # yield streaming response
    async for message in conversation.chat(prompt):
        pending_response += message['content']
        if pending_response and len(pending_response) > 100:
            yield pending_response
            pending_response = ""
    if pending_response:
        yield pending_response
